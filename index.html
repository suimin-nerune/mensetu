<!DOCTYPE html>
<html lang="ja">
<!-- 
  Mensetsu Knock - Interview Practice
  Version: 1.1.0 
  Author: Suimin Nerune
  License: MIT
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="ã‚¹ã‚­ãƒæ™‚é–“ã§é¢æ¥å¯¾ç­–ï¼ã‚¹ãƒãƒ›ã§å®Œçµã™ã‚‹ç·´ç¿’ã‚¢ãƒ—ãƒª">
    <meta name="theme-color" content="#E0F2FE">
    <meta name="format-detection" content="telephone=no">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="é¢æ¥ãƒãƒƒã‚¯">
    <link rel="apple-touch-icon" href="./nerune.png">
    
    <!-- OGP -->
    <meta property="og:title" content="ã‚ã‚“ã›ã¤â˜…ãƒãƒƒã‚¯">
    <meta property="og:type" content="website">
    <meta property="og:image" content="./nerune.png">
    <meta property="og:description" content="1æ—¥3åˆ†ï¼ã‚¹ãƒãƒ›ã§å®Œçµã™ã‚‹é¢æ¥ç·´ç¿’ã‚¢ãƒ—ãƒª">
    <meta name="twitter:card" content="summary_large_image">
    
    <title>ã‚ã‚“ã›ã¤â˜…ãƒãƒƒã‚¯</title>
    
    <!-- Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800&display=swap" rel="stylesheet">
    
    <!-- App Config & Styles -->
    <script>
        const CONFIG = {
            VERSION: '1.1.0',
            URLS: {
                YOUTUBE: "https://www.youtube.com/@suimin_nerune",
                X_SHARE: "https://twitter.com/intent/tweet"
            },
            ACCOUNTS: { X: "@suimin_nerune" },
            THEME: { brand: '#38BDF8', accent: '#FACC15', bg: '#E0F2FE' }
        };

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { DEFAULT: CONFIG.THEME.brand, dark: '#0284C7', light: '#7DD3FC' },
                        accent: { DEFAULT: CONFIG.THEME.accent, dark: '#CA8A04' }
                    },
                    fontFamily: { sans: ['"M PLUS Rounded 1c"', 'sans-serif', 'system-ui'] },
                    animation: {
                        'bounce-sm': 'bounceSm 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'float': 'float 3s ease-in-out infinite',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'fade-in': 'fadeIn 0.2s ease-out forwards',
                    },
                    keyframes: {
                        bounceSm: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-6px)' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        :root { --safe-bottom: env(safe-area-inset-bottom, 20px); }
        body {
            background-color: #E0F2FE;
            background-image: radial-gradient(#bae6fd 15%, transparent 15%);
            background-size: 24px 24px;
            min-height: 100dvh;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }
        .btn-3d {
            transition: transform 0.1s, border-bottom-width 0.1s, filter 0.2s;
            border-bottom-width: 4px;
            position: relative;
            transform: translateY(0);
            will-change: transform;
        }
        .btn-3d:active:not(:disabled) { transform: translateY(2px); border-bottom-width: 2px; }
        .btn-3d:disabled { opacity: 0.6; cursor: not-allowed; filter: grayscale(1); border-bottom-color: #cbd5e1; background-color: #f1f5f9; color: #94a3b8; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-active { color: #38BDF8; stroke: #38BDF8; }
        .tab-inactive { color: #94a3b8; stroke: #94a3b8; }
        
        /* Custom Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #38BDF8; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); margin-top: -8px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #cbd5e1; border-radius: 2px; }
        
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 60; }
        
        /* Toast Notification */
        #toast-container { position: fixed; bottom: calc(4rem + var(--safe-bottom) + 10px); left: 50%; transform: translateX(-50%); z-index: 100; pointer-events: none; width: 90%; max-width: 300px; }
        .toast { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(4px); color: white; padding: 10px 16px; border-radius: 99px; font-size: 13px; font-weight: bold; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(10px); }
        .toast.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="h-[100dvh] w-full overflow-hidden flex flex-col text-slate-700 font-sans">

    <!-- MAIN VIEW -->
    <main id="main-container" class="flex-1 overflow-y-auto no-scrollbar relative pb-24">
        
        <!-- === TAB: HOME === -->
        <section id="tab-home" class="p-6 flex flex-col items-center min-h-full animate-fade-in">
            <!-- Streak -->
            <div id="streak-badge" class="hidden absolute top-4 left-4 bg-white/90 backdrop-blur border border-orange-200 px-3 py-1.5 rounded-full shadow-sm z-10 animate-bounce-sm">
                <span class="text-lg">ğŸ”¥</span><span class="text-xs font-black text-orange-500 ml-1">é€£ç¶š <span id="streak-count">1</span>æ—¥ç›®</span>
            </div>

            <!-- Hero -->
            <div class="mt-6 mb-6 flex flex-col items-center shrink-0">
                <div class="relative w-32 h-32 animate-float">
                    <div class="w-full h-full rounded-full border-[6px] border-white shadow-xl overflow-hidden bg-white relative z-10">
                        <img src="./nerune.png" onerror="this.src='https://img.icons8.com/fluency/192/microphone.png'" class="w-full h-full object-cover" alt="Character">
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-yellow-400 text-white text-[10px] font-bold px-2 py-1 rounded-full border-2 border-white shadow-sm z-20">v1.1</div>
                </div>
                <h1 class="mt-5 text-2xl font-extrabold text-brand tracking-wide drop-shadow-sm">ã‚ã‚“ã›ã¤â˜…ãƒãƒƒã‚¯</h1>
            </div>

            <!-- Settings Panel -->
            <div class="w-full max-w-sm bg-white/80 backdrop-blur rounded-2xl p-5 shadow-sm border border-white mb-8 space-y-4">
                <!-- Mode -->
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 block ml-1">ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</label>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <button onclick="App.setMode('voice')" id="mode-btn-voice" class="flex-1 py-2.5 rounded-lg text-xs font-bold bg-white text-brand shadow-sm transition-all duration-200">ğŸ¤ å£°ã«å‡ºã™</button>
                        <button onclick="App.setMode('silent')" id="mode-btn-silent" class="flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400 transition-all duration-200 hover:text-brand">ğŸšƒ é›»è»Šãƒ¢ãƒ¼ãƒ‰</button>
                    </div>
                </div>
                <!-- Speed & Count Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 block ml-1">å•é¡Œæ•°: <span id="label-limit" class="text-brand">10</span></label>
                        <div class="flex bg-slate-100 p-1 rounded-xl">
                            <button onclick="App.setCount(5)" id="count-btn-5" class="flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400">5</button>
                            <button onclick="App.setCount(10)" id="count-btn-10" class="flex-1 py-2.5 rounded-lg text-xs font-bold bg-white text-brand shadow-sm">10</button>
                            <button onclick="App.setCount(999)" id="count-btn-999" class="flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400">âˆ</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 block ml-1">è©±ã™é€Ÿã•: <span id="label-speed" class="text-brand">1.0</span></label>
                        <!-- UIä¿®æ­£ï¼šã‚¦ã‚µã‚®ãŒè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´(px-3)ã¨overflowå‰Šé™¤ -->
                        <div class="flex items-center h-[38px] px-3 bg-slate-100 rounded-xl">
                            <span class="text-xs mr-2 shrink-0">ğŸ¢</span>
                            <input type="range" min="0.5" max="1.5" step="0.1" value="1.0" class="flex-1 min-w-0" oninput="App.setSpeed(this.value)">
                            <span class="text-xs ml-2 shrink-0">ğŸ‡</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Menu -->
            <div class="w-full max-w-sm space-y-3 mb-10">
                <p class="text-center text-xs font-bold text-slate-400 mb-2">- ã‚³ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆ -</p>
                <button onclick="App.preStartCheck('highschool')" class="btn-3d w-full bg-white border-blue-100 border-b-brand-dark/20 p-3 rounded-2xl flex items-center shadow-sm hover:bg-blue-50 active:bg-blue-100 transition-colors group">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-lg group-active:scale-90 transition-transform">ğŸ«</div>
                    <div class="text-left flex-1 ml-3">
                        <h3 class="font-extrabold text-slate-700">é«˜æ ¡å—é¨“</h3>
                        <p class="text-[10px] text-slate-400 font-bold">å…¨20å• | å¿—æœ›å‹•æ©Ÿãƒ»ä¸­å­¦ç”Ÿæ´»ãªã©</p>
                    </div>
                    <span class="text-brand font-black text-lg">GO</span>
                </button>
                <button onclick="App.preStartCheck('university')" class="btn-3d w-full bg-white border-emerald-100 border-b-emerald-600/20 p-3 rounded-2xl flex items-center shadow-sm hover:bg-emerald-50 active:bg-emerald-100 transition-colors group">
                    <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center text-lg group-active:scale-90 transition-transform">ğŸ“</div>
                    <div class="text-left flex-1 ml-3">
                        <h3 class="font-extrabold text-slate-700">å¤§å­¦ãƒ»å°‚é–€</h3>
                        <p class="text-[10px] text-slate-400 font-bold">å…¨20å• | è‡ªå·±PRãƒ»å°†æ¥ã®å¤¢ãªã©</p>
                    </div>
                    <span class="text-emerald-500 font-black text-lg">GO</span>
                </button>
                <button onclick="App.preStartCheck('job')" class="btn-3d w-full bg-white border-orange-100 border-b-orange-600/20 p-3 rounded-2xl flex items-center shadow-sm hover:bg-orange-50 active:bg-orange-100 transition-colors group">
                    <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center text-lg group-active:scale-90 transition-transform">ğŸ’¼</div>
                    <div class="text-left flex-1 ml-3">
                        <h3 class="font-extrabold text-slate-700">å°±è·ãƒ»å…¬å‹™å“¡</h3>
                        <p class="text-[10px] text-slate-400 font-bold">å…¨20å• | ã‚¬ã‚¯ãƒã‚«ãƒ»å¼·ã¿ãªã©</p>
                    </div>
                    <span class="text-orange-500 font-black text-lg">GO</span>
                </button>
                <button onclick="App.preStartCheck('custom')" class="btn-3d w-full bg-white border-purple-100 border-b-purple-600/20 p-3 rounded-2xl flex items-center shadow-sm hover:bg-purple-50 active:bg-purple-100 transition-colors group">
                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-lg group-active:scale-90 transition-transform">âœ¨</div>
                    <div class="text-left flex-1 ml-3">
                        <h3 class="font-extrabold text-slate-700">Myè³ªå•ã ã‘</h3>
                        <p class="text-[10px] text-slate-400 font-bold">ç™»éŒ²ã—ãŸã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œ</p>
                    </div>
                    <span class="text-purple-500 font-black text-lg">GO</span>
                </button>
            </div>

            <!-- Profile & Privacy -->
            <div class="w-full max-w-sm p-5 bg-white/60 rounded-3xl border border-white text-center shadow-sm">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <!-- Icon Size Fix: w-16 h-16 (64px) ã«æ‹¡å¤§ -->
                    <div class="w-16 h-16 rounded-full bg-white border border-slate-200 overflow-hidden shadow-sm shrink-0">
                        <img src="./nerune.png" onerror="this.src='https://img.icons8.com/fluency/192/microphone.png'" class="w-full h-full object-cover">
                    </div>
                    <div class="text-left min-w-0">
                        <p class="text-sm font-black text-slate-700 truncate">å½—çœ ãƒãƒ«ãƒğŸ’¤</p>
                        <p class="text-[10px] text-slate-500 font-medium leading-tight">YouTubeã§20æ™‚ã«<br>ç¡é­”ã¨é—˜ã†Vtuber</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <!-- Updated Buttons -->
                    <a href="javascript:void(0)" onclick="window.open(CONFIG.URLS.YOUTUBE, '_blank')" class="btn-3d flex items-center justify-center bg-[#FF0000] border-[#cc0000] text-white text-xs font-bold py-3 rounded-xl shadow-sm hover:brightness-110">
                        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                        YouTube
                    </a>
                    <button onclick="Social.shareApp()" class="btn-3d flex items-center justify-center bg-slate-800 border-slate-900 text-white text-xs font-bold py-3 rounded-xl shadow-sm hover:bg-slate-700">
                        <svg class="w-3 h-3 mr-1.5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        ã‚·ã‚§ã‚¢
                    </button>
                </div>
                <!-- Privacy Note -->
                <div class="border-t border-slate-200 pt-3">
                    <p class="text-[9px] text-slate-400 leading-relaxed">
                        ğŸ”’ <span class="font-bold">å®‰å¿ƒè¨­è¨ˆ</span><br>
                        éŒ²éŸ³ã•ã‚ŒãŸéŸ³å£°ãƒ‡ãƒ¼ã‚¿ã¯ã€ãŠä½¿ã„ã®ã‚¹ãƒãƒ›ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰å†…ã§ã®ã¿ä¸€æ™‚çš„ã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚<br>
                        <span class="text-brand font-bold">å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€ä¿¡ã¯ä¸€åˆ‡è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚</span>
                    </p>
                </div>
            </div>
            
            <!-- Install Prompt (Hidden by default) -->
            <button id="btn-install" class="hidden mt-6 bg-slate-800 text-white text-xs font-bold px-6 py-3 rounded-full shadow-lg animate-bounce-sm" onclick="App.installPWA()">
                ğŸ“² ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            </button>

            <!-- Manual Install Guide -->
            <button id="btn-manual-install" onclick="alert('ã€iPhoneã€‘\nç”»é¢ä¸‹ã®å…±æœ‰ãƒœã‚¿ãƒ³ â†’ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€\n\nã€Androidã€‘\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ ã€Œã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€')" class="mt-8 mb-6 text-[10px] text-slate-400 underline decoration-slate-300">
                ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ä½¿ã†
            </button>
        </section>

        <!-- === TAB: LIST === -->
        <section id="tab-list" class="hidden p-6 pb-24 min-h-full animate-fade-in">
            <h2 class="text-xl font-extrabold text-slate-700 mb-6 flex items-center">
                ğŸ“ è³ªå•ãƒªã‚¹ãƒˆ <span class="text-[10px] font-bold text-white bg-slate-300 px-2 py-0.5 rounded-md ml-2">Myè³ªå•è¿½åŠ </span>
            </h2>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 mb-6">
                <input type="text" id="new-q-text" placeholder="è³ªå•æ–‡ï¼ˆä¾‹ï¼šæ ¡è¨“ã¯ï¼Ÿï¼‰" class="w-full bg-slate-50 p-3 rounded-xl text-sm font-bold mb-3 border border-slate-200 focus:border-brand focus:ring-1 focus:ring-brand outline-none transition">
                <input type="text" id="new-q-hint" placeholder="ãƒ’ãƒ³ãƒˆï¼ˆä¾‹ï¼šè‡ªä¸»è‡ªç«‹ï¼‰" class="w-full bg-slate-50 p-3 rounded-xl text-sm mb-4 border border-slate-200 focus:border-brand focus:ring-1 focus:ring-brand outline-none transition">
                <button onclick="UserData.add()" class="btn-3d w-full bg-brand border-brand-dark text-white font-bold py-3 rounded-xl shadow-md">ï¼‹ ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
            </div>
            <div id="questions-list-container" class="space-y-4"></div>
        </section>

        <!-- === TAB: HISTORY === -->
        <section id="tab-history" class="hidden p-6 pb-24 min-h-full animate-fade-in">
            <h2 class="text-xl font-extrabold text-slate-700 mb-6">ğŸ“Š ç·´ç¿’ã®ã‚ã‚†ã¿</h2>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 text-center">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">ç´¯è¨ˆå›ç­”</p>
                    <p class="text-3xl font-black text-brand mt-1" id="stat-count">0</p>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 text-center">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">å¹³å‡ã‚¹ã‚³ã‚¢</p>
                    <div class="flex items-center justify-center mt-1">
                        <span class="text-xl mr-1">â­</span>
                        <p class="text-3xl font-black text-slate-700" id="stat-avg">-</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-6">
                <div class="p-3 bg-slate-50 border-b border-slate-100 text-[10px] font-bold text-slate-400 uppercase tracking-wide">æœ€è¿‘ã®è¨˜éŒ²</div>
                <div id="history-list" class="divide-y divide-slate-100 max-h-80 overflow-y-auto"></div>
            </div>
            <button onclick="UserData.clearHistory()" class="text-xs font-bold text-red-400 underline w-full text-center py-4">å±¥æ­´ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆ</button>
        </section>
    </main>

    <!-- === OVERLAY: PRACTICE === -->
    <div id="view-practice" class="hidden fixed inset-0 z-50 bg-[#E0F2FE] flex flex-col safe-area-padding">
        
        <!-- Pre-Start Check (Overlay) -->
        <div id="start-overlay" class="absolute inset-0 z-[60] bg-slate-900/40 backdrop-blur-md flex items-center justify-center p-6 animate-fade-in">
            <div class="bg-white w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl animate-bounce-sm">
                <div class="w-20 h-20 mx-auto bg-slate-100 rounded-full flex items-center justify-center text-4xl mb-4">ğŸ¤</div>
                <h3 class="text-xl font-black text-slate-800 mb-2">æº–å‚™ã¯ã„ã„ï¼Ÿ</h3>
                <p class="text-sm text-slate-500 mb-8 font-bold" id="start-msg">éŸ³ãŒå‡ºã¾ã™ã€‚éŸ³é‡ã«æ³¨æ„ã—ã¦ã­ï¼</p>
                <button onclick="App.realStart()" class="btn-3d w-full bg-brand border-brand-dark text-white font-bold py-4 rounded-xl shadow-lg text-lg flex items-center justify-center">
                    OKï¼ã‚¹ã‚¿ãƒ¼ãƒˆ
                </button>
            </div>
        </div>

        <!-- Header -->
        <nav class="flex items-center justify-between px-4 pt-4 pb-2 bg-white/60 backdrop-blur-md">
            <button onclick="App.quit()" class="text-slate-400 font-bold text-sm bg-white border border-slate-200 px-3 py-1.5 rounded-full shadow-sm hover:text-red-500">âœ• ä¸­æ–­</button>
            <div class="bg-white border-2 border-brand text-brand px-4 py-1 rounded-full font-mono font-bold shadow-sm">
                <span id="timer-display">00:00</span>
            </div>
            <span id="q-counter" class="text-[10px] font-black text-slate-400 bg-white px-2 py-1 rounded-lg border border-slate-200">INIT</span>
        </nav>

        <!-- Question Area -->
        <div class="flex-1 flex flex-col items-center p-6 overflow-y-auto relative">
            <div class="w-20 h-20 rounded-full border-4 border-white bg-white mb-6 shadow-sm shrink-0 z-10">
                <img src="./nerune.png" onerror="this.src='https://img.icons8.com/fluency/192/microphone.png'" class="w-full h-full object-cover">
            </div>
            
            <div class="w-full bg-white rounded-[2rem] p-8 shadow-xl border-4 border-white relative mb-4">
                <div class="absolute -top-3 left-1/2 -ml-2 w-6 h-6 bg-white rotate-45"></div>
                <div class="text-center">
                    <h2 id="question-text" class="text-xl md:text-2xl font-bold text-slate-800 leading-relaxed min-h-[4rem] flex items-center justify-center">Loading...</h2>
                    <button id="btn-speak" onclick="App.speak()" class="mt-6 text-brand text-xs font-bold bg-blue-50 px-4 py-2 rounded-full hover:bg-blue-100 transition flex items-center justify-center mx-auto">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                        ã‚‚ã†ä¸€åº¦ãã
                    </button>
                </div>
            </div>

            <!-- Hint -->
            <div class="w-full px-2 mt-auto">
                <div id="hint-box" class="hidden bg-yellow-50 border-2 border-accent p-4 rounded-2xl text-yellow-900 text-sm mb-4 animate-slide-up shadow-sm">
                    <p class="font-bold mb-1 flex items-center text-accent-dark">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"/></svg> ãƒ’ãƒ³ãƒˆ
                    </p>
                    <span id="hint-text" class="leading-relaxed">--</span>
                </div>
                <button id="btn-hint" onclick="App.toggleHint()" class="w-full text-center text-slate-400 text-xs font-bold underline decoration-dotted py-4">ç­”ãˆãŒã‚ã‹ã‚‰ãªã„æ™‚ï¼ˆãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºï¼‰</button>
            </div>
        </div>
        
        <!-- Control Area -->
        <div class="bg-white p-6 pb-8 rounded-t-[2.5rem] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] z-20">
            <div id="player-area" class="hidden mb-6 bg-slate-50 border border-slate-100 rounded-full px-2 py-1">
                <audio id="audio-player" controls class="w-full h-10"></audio>
            </div>
            
            <div id="ctrl-answer" class="flex justify-center min-h-[5rem] items-center">
                <button id="btn-rec" onclick="App.toggleRecord()" class="btn-3d w-20 h-20 rounded-full bg-accent border-accent-dark text-white shadow-xl flex items-center justify-center transform active:scale-95 transition">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.66 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                </button>
                <button id="btn-stop" onclick="App.toggleRecord()" class="hidden w-20 h-20 rounded-full bg-red-500 border-4 border-white text-white shadow-xl flex items-center justify-center animate-pulse">
                    <div class="w-8 h-8 bg-white rounded-md"></div>
                </button>
                <button id="btn-silent" onclick="App.finishAnswer()" class="hidden btn-3d w-full bg-emerald-500 border-emerald-700 text-white font-bold py-4 rounded-2xl text-lg shadow-lg">ğŸ§  é ­ã®ä¸­ã§å›ç­”å®Œäº†ï¼</button>
                <p id="mic-error" class="hidden text-xs text-red-400 font-bold mt-2 text-center leading-tight">ãƒã‚¤ã‚¯ãŒä½¿ãˆã¾ã›ã‚“<br><span class="text-[10px] text-slate-400">ç«¯æœ«ã®è¨­å®šã§è¨±å¯ã—ã¦ãã ã•ã„</span></p>
            </div>

            <div id="ctrl-rate" class="hidden text-center animate-slide-up">
                <p class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-widest">Self Check</p>
                <div class="flex justify-center gap-4">
                    <button onclick="App.saveResult(1)" class="btn-rate btn-3d w-20 flex flex-col items-center p-2 bg-slate-100 border-slate-300 rounded-2xl">
                        <span class="text-3xl mb-1">ğŸ˜–</span><span class="text-[10px] font-bold text-slate-500">ã‚¤ãƒã‚¤ãƒ</span>
                    </button>
                    <button onclick="App.saveResult(3)" class="btn-rate btn-3d w-20 flex flex-col items-center p-2 bg-white border-slate-200 rounded-2xl">
                        <span class="text-3xl mb-1">ğŸ˜</span><span class="text-[10px] font-bold text-slate-500">ãµã¤ã†</span>
                    </button>
                    <button onclick="App.saveResult(5)" class="btn-rate btn-3d w-20 flex flex-col items-center p-2 bg-yellow-50 border-accent rounded-2xl">
                        <span class="text-3xl mb-1">ğŸ˜†</span><span class="text-[10px] font-bold text-accent-dark">ãƒãƒƒãƒãƒª</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- === MODAL: RESULT === -->
    <div id="modal-result" class="hidden fixed inset-0 z-[100] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
        <canvas id="confetti-canvas"></canvas>
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 shadow-2xl animate-bounce-sm text-center relative z-20">
            <h2 class="text-2xl font-extrabold text-brand mb-2">ğŸ‰ ãŠã¤ã‹ã‚Œã•ã¾ï¼</h2>
            <div class="w-24 h-24 mx-auto my-5 rounded-full border-4 border-accent overflow-hidden shadow-lg bg-white">
                <img src="./nerune.png" onerror="this.src='https://img.icons8.com/fluency/192/microphone.png'" class="w-full h-full object-cover">
            </div>
            <div class="bg-slate-50 rounded-2xl p-5 mb-6 border border-slate-100">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Result</p>
                <div class="flex justify-center items-baseline space-x-1">
                    <span class="text-4xl font-black text-slate-800" id="res-count">0</span>
                    <span class="text-sm font-bold text-slate-500">å•ã‚¯ãƒªã‚¢</span>
                </div>
                <div class="mt-2 text-sm font-bold text-accent-dark" id="res-msg">Good Job!</div>
            </div>
            <button onclick="Social.shareResult()" class="btn-3d w-full bg-black border-slate-800 text-white font-bold py-3.5 rounded-xl mb-3 shadow-lg flex items-center justify-center">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                çµæœã‚’ãƒã‚¹ãƒˆã™ã‚‹
            </button>
            <button onclick="App.closeResult()" class="text-xs font-bold text-slate-400 p-2 hover:text-brand">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>
    </div>

    <!-- === MODAL: MANNER === -->
    <div id="modal-manner" class="hidden fixed inset-0 z-[90] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl animate-bounce-sm">
            <h2 class="text-xl font-extrabold text-brand text-center mb-6">ğŸ‘€ èº«ã ã—ãªã¿ãƒã‚§ãƒƒã‚¯</h2>
            <ul class="space-y-4 mb-8">
                <li class="flex items-center p-3 bg-slate-50 rounded-xl"><span class="text-2xl mr-3">ğŸ‘”</span><span class="text-sm font-bold text-slate-600">æœè£…ã¯ä¹±ã‚Œã¦ãªã„ï¼Ÿ</span></li>
                <li class="flex items-center p-3 bg-slate-50 rounded-xl"><span class="text-2xl mr-3">ğŸ’‡</span><span class="text-sm font-bold text-slate-600">é«ªå‹ã¯ã‚¹ãƒƒã‚­ãƒªï¼Ÿ</span></li>
                <li class="flex items-center p-3 bg-slate-50 rounded-xl"><span class="text-2xl mr-3">âœ¨</span><span class="text-sm font-bold text-slate-600">èƒŒç­‹ã¯ä¼¸ã³ã¦ã‚‹ï¼Ÿ</span></li>
            </ul>
            <button onclick="App.startPractice()" class="btn-3d w-full bg-brand border-brand-dark text-white font-bold py-4 rounded-xl shadow-lg text-lg">OKï¼ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <p class="text-center text-[10px] text-slate-300 mt-4">â€»æœ¬æ—¥ã¯ã“ã‚Œä»¥é™è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</p>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast-container"></div>

    <!-- NAVBAR -->
    <nav class="fixed bottom-0 w-full bg-white/90 backdrop-blur border-t border-slate-200 flex justify-around pb-[env(safe-area-inset-bottom)] pt-2 z-40 h-[calc(4rem+env(safe-area-inset-bottom))]">
        <button onclick="App.switchTab('home')" class="flex flex-col items-center w-1/3 tab-active group" id="nav-home">
            <svg class="w-6 h-6 mb-1 icon-svg group-active:scale-90 transition" viewBox="0 0 24 24"><path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/></svg>
            <span class="text-[10px] font-bold">ãƒ›ãƒ¼ãƒ </span>
        </button>
        <button onclick="App.switchTab('list')" class="flex flex-col items-center w-1/3 tab-inactive group" id="nav-list">
            <svg class="w-6 h-6 mb-1 icon-svg group-active:scale-90 transition" viewBox="0 0 24 24"><path d="M7 7h10v2H7zm0 4h10v2H7z"/><path d="M20.1 3H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9zM19 19H5V5h14v14z"/></svg>
            <span class="text-[10px] font-bold">ãƒªã‚¹ãƒˆ</span>
        </button>
        <button onclick="App.switchTab('history')" class="flex flex-col items-center w-1/3 tab-inactive group" id="nav-history">
            <svg class="w-6 h-6 mb-1 icon-svg group-active:scale-90 transition" viewBox="0 0 24 24"><path d="M13.5 13.48l-4-2.31V7a.5.5 0 011 0v3.58l3.5 2.02a.5.5 0 11-.5.88z"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
            <span class="text-[10px] font-bold">ã‚ã‚†ã¿</span>
        </button>
    </nav>

    <!-- === LOGIC === -->
    <script>
        const DB={questions:{highschool:[{q:"å¿—æœ›å‹•æ©Ÿã‚’æ•™ãˆã¦ãã ã•ã„ã€‚",hint:"ã€Œãªãœã“ã®å­¦æ ¡ã‹ã€ï¼‹ã€Œå…¥å­¦å¾Œã‚„ã‚ŠãŸã„ã“ã¨ã€"},{q:"ä¸­å­¦æ ¡ã§ä¸€ç•ªé ‘å¼µã£ãŸã“ã¨ã¯ï¼Ÿ",hint:"éƒ¨æ´»ã‚„è¡Œäº‹ã€‚çµæœã‚ˆã‚Šãƒ—ãƒ­ã‚»ã‚¹ã‚’å¤§åˆ‡ã«ã€‚"},{q:"ã‚ãªãŸã®é•·æ‰€ã¨çŸ­æ‰€ã¯ï¼Ÿ",hint:"é•·æ‰€ã¯ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§ã€‚çŸ­æ‰€ã¯æ”¹å–„ç­–ã‚‚ã€‚"},{q:"æœ€è¿‘æ°—ã«ãªã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ï¼Ÿ",hint:"è‡ªåˆ†ã®æ„è¦‹ã‚’ä¸€è¨€æ·»ãˆã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã€‚"},{q:"å°†æ¥ã®å¤¢ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",hint:"é«˜æ ¡ç”Ÿæ´»ã¨ã©ã†ç¹‹ãŒã‚‹ã‹è©±ãã†ã€‚"},{q:"æœ¬æ ¡ã®æ ¡å‰‡ã«ã¤ã„ã¦ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿ",hint:"ç¤¾ä¼šã®ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹å§¿å‹¢ã‚’è¦‹ã›ã‚‹ã€‚"},{q:"å¾—æ„æ•™ç§‘ãƒ»è‹¦æ‰‹æ•™ç§‘ã¯ï¼Ÿ",hint:"è‹¦æ‰‹ãªã‚‚ã®ã¸ã®å–ã‚Šçµ„ã¿æ–¹ã‚’è©±ãã†ã€‚"},{q:"ä¼‘æ—¥ã®éã”ã—æ–¹ã¯ï¼Ÿ",hint:"è¶£å‘³ã‚„å‹‰å¼·ãªã©ãƒ¡ãƒªãƒãƒªã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚"},{q:"é€šå­¦çµŒè·¯ã¨æ™‚é–“ã¯ï¼Ÿ",hint:"æ­£ç¢ºã«ã€‚ä»£æ›¿æ‰‹æ®µã‚‚è¨€ãˆã‚‹ã¨ãƒ™ã‚¹ãƒˆã€‚"},{q:"æœ€è¿‘èª­ã‚“ã æœ¬ã¯ï¼Ÿ",hint:"æ¼«ç”»ä»¥å¤–æ¨å¥¨ã€‚æ„Ÿæƒ³ã‚’ç°¡å˜ã«ã€‚"},{q:"å°Šæ•¬ã™ã‚‹äººã¯ï¼Ÿ",hint:"ã€Œãªãœå°Šæ•¬ã™ã‚‹ã‹ã€ã®ç†ç”±ãŒé‡è¦ã€‚"},{q:"å‹äººã‹ã‚‰ã©ã†è¨€ã‚ã‚Œã¾ã™ã‹ï¼Ÿ",hint:"å®¢è¦³çš„ãªè‡ªå·±åˆ†æãŒã§ãã¦ã„ã‚‹ã‹ã€‚"},{q:"è‡ªå·±PRã‚’1åˆ†ã§ã€‚",hint:"å¼·ã¿ã‚’ä¸€ã¤ã«çµã£ã¦ç†±æ„ã‚’è¾¼ã‚ã‚ˆã†ã€‚"},{q:"å’æ¥­å¾Œã®é€²è·¯ã¯ï¼Ÿ",hint:"æœªå®šã§ã‚‚ã€Œæ¢ã—ã¦ã„ããŸã„ã€ã¨å‰å‘ãã«ã€‚"},{q:"å…¥ã‚ŠãŸã„éƒ¨æ´»ã¯ï¼Ÿ",hint:"å‹‰å¼·ã¨ã®ä¸¡ç«‹ã‚‚å«ã‚ã¦è©±ãã†ã€‚"},{q:"æœ€è¿‘æ€’ã£ãŸã“ã¨ã¯ï¼Ÿ",hint:"æ„Ÿæƒ…ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åŠ›ãŒè¦‹ã‚‰ã‚Œã¦ã„ã‚‹ã€‚"},{q:"ã‚ãªãŸã®å®ç‰©ã¯ï¼Ÿ",hint:"å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³ã‚’ä¼ãˆã‚ˆã†ã€‚"},{q:"è‹¦æ‰‹ãªäººã¨ã®æ¥ã—æ–¹ã¯ï¼Ÿ",hint:"ã€Œã“ã†å·¥å¤«ã—ã¦æ¥ã—ã¾ã™ã€ã¨å¯¾å‡¦æ³•ã‚’ã€‚"},{q:"æœ€å¾Œã«ä¸€è¨€ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",hint:"ç†±æ„ã‚’ä¼ãˆã‚‹ãƒ©ã‚¹ãƒˆãƒãƒ£ãƒ³ã‚¹ï¼"}],university:[{q:"æœ¬å­¦ã‚’å¿—æœ›ã—ãŸç†ç”±ã¯ï¼Ÿ",hint:"ã‚¢ãƒ‰ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã¨çµ¡ã‚ã¦è©±ãã†ã€‚"},{q:"é«˜æ ¡æ™‚ä»£ã«åŠ›ã‚’å…¥ã‚ŒãŸã“ã¨ã¯ï¼Ÿ",hint:"å›°é›£â†’å·¥å¤«â†’è§£æ±ºâ†’å­¦ã³ ã®æµã‚Œã§ã€‚"},{q:"å…¥å­¦å¾Œã€ä½•ã‚’å­¦ã³ãŸã„ï¼Ÿ",hint:"å…·ä½“çš„ãªæˆæ¥­åã‚„ã‚¼ãƒŸåã‚’å‡ºãã†ã€‚"},{q:"è‡ªå·±PRã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",hint:"çµè«–â†’æ ¹æ‹ â†’çµè«–ã®ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒæ³•ã§ã€‚"},{q:"å°†æ¥ã®ã‚­ãƒ£ãƒªã‚¢ãƒ—ãƒ©ãƒ³ã¯ï¼Ÿ",hint:"å¤§å­¦ã§ã®å­¦ã³ãŒã©ã†ä»•äº‹ã«æ´»ãã‚‹ã‹ã€‚"},{q:"é•·æ‰€ã‚’ã©ã†æ´»ã‹ã™ï¼Ÿ",hint:"ã€Œå”èª¿æ€§ã§ãƒãƒ¼ãƒ ã‚’ã¾ã¨ã‚ã‚‹ã€ãªã©ã€‚"},{q:"é–¢å¿ƒã®ã‚ã‚‹ç¤¾ä¼šå•é¡Œã¯ï¼Ÿ",hint:"å¿—æœ›å­¦éƒ¨ã«é–¢é€£ã™ã‚‹è©±é¡Œã‚’é¸ã¼ã†ã€‚"},{q:"é«˜æ ¡ã®æˆç¸¾ã«ã¤ã„ã¦ã€‚",hint:"è‰¯ã„ç‚¹ã¯ç¶™ç¶šã€æ‚ªã„ç‚¹ã¯æ”¹å–„ã®æ„æ€ã‚’ã€‚"},{q:"ã‚ªãƒ¼ãƒ—ãƒ³ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã®æ„Ÿæƒ³ã¯ï¼Ÿ",hint:"é›°å›²æ°—ã‚„è¨­å‚™ã®å°è±¡ã‚’å…·ä½“çš„ã«ã€‚"},{q:"ãƒªãƒ¼ãƒ€ãƒ¼çµŒé¨“ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",hint:"ã‚µãƒãƒ¼ãƒˆå½¹ã§ã‚‚è²¢çŒ®åº¦ã‚’è©±ã›ã°OKã€‚"},{q:"ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆæ³•ã¯ï¼Ÿ",hint:"è‡ªå·±ç®¡ç†èƒ½åŠ›ãŒã‚ã‚‹ã‹è¦‹ã‚‰ã‚Œã¦ã„ã‚‹ã€‚"},{q:"åº§å³ã®éŠ˜ã¯ï¼Ÿ",hint:"ãã®è¨€è‘‰ã‚’é¸ã‚“ã ä½“é¨“è«‡ã‚’æ·»ãˆã¦ã€‚"},{q:"ä½µé¡˜æ ¡ã¨ãã®ç†ç”±ã¯ï¼Ÿ",hint:"é¸ã¶ã€Œè»¸ã€ãŒãƒ–ãƒ¬ã¦ã„ãªã„ã‹ç¢ºèªã€‚"},{q:"å¤§å­¦ã¨é«˜æ ¡ã®é•ã„ã¯ï¼Ÿ",hint:"ã€Œè‡ªä¸»æ€§ã€ãŒã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‚"},{q:"å’è«–ã®ãƒ†ãƒ¼ãƒã¯è€ƒãˆã¦ã‚‹ï¼Ÿ",hint:"ç¾æ™‚ç‚¹ã§ã®èˆˆå‘³é–¢å¿ƒã§OKã€‚"},{q:"æœ€è¿‘æ„Ÿå‹•ã—ãŸã“ã¨ã¯ï¼Ÿ",hint:"è±Šã‹ãªæ„Ÿæ€§ãŒã‚ã‚‹ã‹ã€‚"},{q:"æ„è¦‹ãŒå‰²ã‚ŒãŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ",hint:"è©±ã—åˆã„ã§è§£æ±ºã™ã‚‹å§¿å‹¢ã€‚"},{q:"ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢çµŒé¨“ã¯ï¼Ÿ",hint:"ç¤¾ä¼šè²¢çŒ®ã¸ã®æ„è­˜ã€‚"},{q:"ã‚ãªãŸã«ã¨ã£ã¦æ•™é¤Šã¨ã¯ï¼Ÿ",hint:"çŸ¥è­˜ï¼‹äººé–“æ€§ã€‚"},{q:"æœ€å¾Œã«è³ªå•ã¯ï¼Ÿ",hint:"æ„æ¬²ã‚’è¦‹ã›ã‚‹è³ªå•ã‚’ä¸€ã¤ç”¨æ„ã—ã‚ˆã†ã€‚"}],job:[{q:"å½“ç¤¾ã‚’å¿—æœ›ã—ãŸç†ç”±ã¯ï¼Ÿ",hint:"ã€Œå¥½ãã€ï¼‹ã€Œè²¢çŒ®ã§ãã‚‹ã“ã¨ã€ã€‚"},{q:"ã‚¬ã‚¯ãƒã‚«ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚",hint:"æ•°å€¤ã‚’ä½¿ã£ã¦å…·ä½“çš„ã«æˆæœã‚’ç¤ºãã†ã€‚"},{q:"å¼·ã¿ã¨å¼±ã¿ã¯ï¼Ÿ",hint:"å¼±ã¿ã¯å¯¾ç­–ã¨ã‚»ãƒƒãƒˆã§è©±ã™ã“ã¨ã€‚"},{q:"å…¥ç¤¾å¾Œã«ã‚„ã‚ŠãŸã„ä»•äº‹ã¯ï¼Ÿ",hint:"ä¼šç¤¾ã®äº‹æ¥­ã‚’ç†è§£ã—ã¦ã„ã‚‹ã‹ç¢ºèªã€‚"},{q:"ã‚¢ãƒ«ãƒã‚¤ãƒˆçµŒé¨“ã¯ï¼Ÿ",hint:"åƒãå§¿å‹¢ã‚„èº«ã«ã¤ã‘ãŸã‚¹ã‚­ãƒ«ã‚’ã€‚"},{q:"é€†è³ªå•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",hint:"åƒãæ„æ¬²ãŒä¼ã‚ã‚‹è³ªå•ã‚’ã€‚"},{q:"5å¹´å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³ã¯ï¼Ÿ",hint:"é•·ãåƒãæ„æ€ãŒã‚ã‚‹ã‹ã€‚"},{q:"å‘¨ã‚Šã®è©•ä¾¡ã¯ï¼Ÿ",hint:"è‡ªå·±è©•ä¾¡ã¨ã®ã‚ºãƒ¬ãŒãªã„ã‹ã€‚"},{q:"æŒ«æŠ˜çµŒé¨“ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",hint:"ãã“ã‹ã‚‰ã©ã†ç«‹ã¡ç›´ã£ãŸã‹ãŒå¤§äº‹ã€‚"},{q:"è‹¦æ‰‹ãªäººã¸ã®å¯¾å¿œã¯ï¼Ÿ",hint:"çµ„ç¹”ã§åƒãä¸Šã§ã®å”èª¿æ€§ã€‚"},{q:"æ°—ã«ãªã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ï¼Ÿ",hint:"æ¥­ç•Œé–¢é€£ã ã¨å‹‰å¼·ç†±å¿ƒã«è¦‹ãˆã‚‹ã€‚"},{q:"ä»•äº‹ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ",hint:"ãŠé‡‘ä»¥å¤–ã®ä¾¡å€¤è¦³ã‚’ã€‚"},{q:"é›†å›£ã§ã®å½¹å‰²ã¯ï¼Ÿ",hint:"ãƒªãƒ¼ãƒ€ãƒ¼ã€èª¿æ•´å½¹ãªã©ã€‚"},{q:"ä»–ç¤¾ã®é¸è€ƒçŠ¶æ³ã¯ï¼Ÿ",hint:"ä¸€è²«æ€§ãŒã‚ã‚Œã°æ­£ç›´ã«ç­”ãˆã¦OKã€‚"},{q:"å½“ç¤¾ã®è£½å“ã®å°è±¡ã¯ï¼Ÿ",hint:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç›®ç·šï¼‹æ”¹å–„ææ¡ˆãŒã‚ã‚Œã°â—ã€‚"},{q:"å­¦æ¥­ä»¥å¤–ã§æ²¡é ­ã—ãŸã“ã¨ã¯ï¼Ÿ",hint:"é›†ä¸­åŠ›ã®ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚"},{q:"å‹¤å‹™åœ°ã®å¸Œæœ›ã¯ï¼Ÿ",hint:"æŸ”è»Ÿãªå§¿å‹¢ã‚’è¦‹ã›ã‚ˆã†ã€‚"},{q:"ä½“èª¿ç®¡ç†ã§æ°—ã‚’ã¤ã‘ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ",hint:"ç¤¾ä¼šäººã®åŸºæœ¬ãŒã§ãã¦ã„ã‚‹ã‹ã€‚"},{q:"è¦ªã®äº†æ‰¿ã¯å¾—ã¦ã„ã¾ã™ã‹ï¼Ÿ",hint:"å†…å®šè¾é€€ã®é˜²æ­¢ç¢ºèªã€‚"},{q:"è‡ªå·±PRã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",hint:"æ±‚ã‚ã‚‹äººç‰©åƒã«ãƒãƒƒãƒã•ã›ã¦ã€‚"}]}};
        const State={mode:'voice',limit:10,speed:1.0,course:'',deck:[],currentQ:null,count:0,results:[],mediaRecorder:null,timer:null,sec:0,utterance:null,voice:null,userQuestions:[],history:[],deferredPrompt:null};
        const Utils={storage:{get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k))||d}catch{return d}},set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch(e){console.warn(e)}}},toast:(msg)=>{const c=document.getElementById('toast-container');const t=document.createElement('div');t.className='toast';t.innerText=msg;c.appendChild(t);void t.offsetWidth;t.classList.add('show');setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),300)},2000)},createConfetti:()=>{const c=document.getElementById('confetti-canvas');const ctx=c.getContext('2d');c.width=window.innerWidth;c.height=window.innerHeight;const p=[];const clr=['#38BDF8','#FACC15','#F472B6','#4ADE80'];for(let i=0;i<100;i++){p.push({x:Math.random()*c.width,y:Math.random()*c.height-c.height,color:clr[Math.floor(Math.random()*clr.length)],size:Math.random()*8+4,speed:Math.random()*5+2,angle:Math.random()*6.2})}function draw(){ctx.clearRect(0,0,c.width,c.height);p.forEach(pt=>{pt.y+=pt.speed;pt.x+=Math.sin(pt.angle)*2;pt.angle+=0.1;if(pt.y>c.height)pt.y=-20;ctx.fillStyle=pt.color;ctx.fillRect(pt.x,pt.y,pt.size,pt.size)});if(document.getElementById('modal-result').classList.contains('hidden'))return;requestAnimationFrame(draw)}draw()}};
        
        const App={
            init:()=>{
                State.userQuestions=Utils.storage.get('myQuestions',[]);State.history=Utils.storage.get('history',[]);App.initVoice();
                if(window.speechSynthesis.onvoiceschanged!==undefined){window.speechSynthesis.onvoiceschanged=App.initVoice}
                App.renderList();App.renderHistory();App.checkStreak();
                document.addEventListener('visibilitychange',()=>{if(document.hidden){window.speechSynthesis.cancel();clearInterval(State.timer)}});
                if(!navigator.mediaDevices||!window.MediaRecorder){document.getElementById('btn-rec').classList.add('hidden');document.getElementById('mic-error').classList.remove('hidden')}
                window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();State.deferredPrompt=e;document.getElementById('btn-install').classList.remove('hidden');document.getElementById('btn-manual-install').classList.add('hidden')});
            },
            installPWA:async()=>{if(State.deferredPrompt){State.deferredPrompt.prompt();const {outcome}=await State.deferredPrompt.userChoice;if(outcome==='accepted'){State.deferredPrompt=null;document.getElementById('btn-install').classList.add('hidden')}}},
            initVoice:()=>{const voices=window.speechSynthesis.getVoices();const jpVoices=voices.filter(v=>v.lang.includes('ja'));if(jpVoices.length>0){State.voice=jpVoices.find(v=>v.name.includes('Google'))||jpVoices.find(v=>v.name.includes('Microsoft'))||jpVoices[0]}},
            switchTab:(id)=>{['home','list','history'].forEach(t=>{document.getElementById(`tab-${t}`).classList.add('hidden');const n=document.getElementById(`nav-${t}`);n.classList.remove('tab-active');n.classList.add('tab-inactive')});document.getElementById(`tab-${id}`).classList.remove('hidden');const a=document.getElementById(`nav-${id}`);a.classList.remove('tab-inactive');a.classList.add('tab-active');if(id==='list')App.renderList();if(id==='history')App.renderHistory()},
            setMode:(m)=>{State.mode=m;const v=document.getElementById('mode-btn-voice'),s=document.getElementById('mode-btn-silent');if(m==='voice'){v.className="flex-1 py-2.5 rounded-lg text-xs font-bold bg-white text-brand shadow-sm transition-all";s.className="flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400 transition-all"}else{v.className="flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400 transition-all";s.className="flex-1 py-2.5 rounded-lg text-xs font-bold bg-white text-emerald-500 shadow-sm transition-all"}},
            setCount:(n)=>{State.limit=n;document.getElementById('label-limit').innerText=n===999?'ç„¡é™':`${n}å•`;[5,10,999].forEach(x=>{const b=document.getElementById(`count-btn-${x}`);b.className=x===n?"flex-1 py-2.5 rounded-lg text-xs font-bold bg-white text-brand shadow-sm transition-all":"flex-1 py-2.5 rounded-lg text-xs font-bold text-slate-400 transition-all"})},
            setSpeed:(v)=>{State.speed=parseFloat(v);document.getElementById('label-speed').innerText=v},
            preStartCheck:(c)=>{State.course=c;const t=new Date().toDateString();if(Utils.storage.get('lastMannerCheck','')===t){App.startPractice()}else{document.getElementById('modal-manner').classList.remove('hidden');Utils.storage.set('lastMannerCheck',t)}},
            startPractice:()=>{document.getElementById('modal-manner').classList.add('hidden');document.getElementById('view-practice').classList.remove('hidden');document.getElementById('start-overlay').classList.remove('hidden');document.getElementById('start-msg').innerText=State.mode==='voice'?"éŸ³ãŒå‡ºã¾ã™ã€‚éŸ³é‡ã«æ³¨æ„ã—ã¦ã­ï¼":"é›»è»Šãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚éŸ³ã¯å‡ºã¾ã›ã‚“ã€‚";State.count=0;State.results=[];State.deck=[];if(State.course==='custom'){State.deck=[...State.userQuestions];if(State.deck.length===0){alert("Myè³ªå•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒªã‚¹ãƒˆã‚¿ãƒ–ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");App.quit();return}}else{State.deck=[...DB.questions[State.course]]}},
            realStart:()=>{window.speechSynthesis.cancel();document.getElementById('start-overlay').classList.add('hidden');App.updateCounter();App.nextQuestion()},
            nextQuestion:()=>{if((State.course!=='custom'&&State.limit!==999&&State.deck.length===0)||State.count>=State.limit){App.showResult();return}if(State.limit===999&&State.deck.length===0){State.deck=[...(State.course==='custom'?State.userQuestions:DB.questions[State.course])]}App.resetUI();const i=Math.floor(Math.random()*State.deck.length);State.currentQ=State.deck[i];State.deck.splice(i,1);App.updateCounter();document.getElementById('question-text').innerText=State.currentQ.q;document.getElementById('hint-text').innerText=State.currentQ.hint||"ãªã—";if(State.mode==='voice')App.speak();App.startTimer()},
            resetUI:()=>{document.getElementById('hint-box').classList.add('hidden');document.getElementById('btn-hint').classList.remove('hidden');document.getElementById('ctrl-answer').classList.remove('hidden');document.getElementById('ctrl-rate').classList.add('hidden');document.getElementById('player-area').classList.add('hidden');document.querySelectorAll('.btn-rate').forEach(b=>b.disabled=false);['btn-rec','btn-stop','btn-silent','btn-speak'].forEach(i=>document.getElementById(i).classList.add('hidden'));if(State.mode==='voice'){if(navigator.mediaDevices&&window.MediaRecorder){document.getElementById('btn-rec').classList.remove('hidden')}else{document.getElementById('btn-silent').classList.remove('hidden')}document.getElementById('btn-speak').classList.remove('hidden')}else{document.getElementById('btn-silent').classList.remove('hidden')}},
            speak:()=>{window.speechSynthesis.cancel();State.utterance=new SpeechSynthesisUtterance(State.currentQ.q);State.utterance.lang="ja-JP";State.utterance.rate=State.speed;if(State.voice)State.utterance.voice=State.voice;window.speechSynthesis.speak(State.utterance)},
            toggleRecord:async()=>{if(!State.mediaRecorder||State.mediaRecorder.state==='inactive'){try{window.speechSynthesis.cancel();const s=await navigator.mediaDevices.getUserMedia({audio:true});State.mediaRecorder=new MediaRecorder(s);let c=[];State.mediaRecorder.ondataavailable=e=>c.push(e.data);State.mediaRecorder.onstop=()=>{const type=State.mediaRecorder.mimeType||'audio/webm';const b=new Blob(c,{type:type});document.getElementById('audio-player').src=URL.createObjectURL(b);document.getElementById('player-area').classList.remove('hidden');App.toRatingPhase();s.getTracks().forEach(t=>t.stop())};State.mediaRecorder.start();document.getElementById('btn-rec').classList.add('hidden');document.getElementById('btn-stop').classList.remove('hidden')}catch(e){console.error(e);document.getElementById('mic-error').classList.remove('hidden')}}else{State.mediaRecorder.stop();document.getElementById('btn-stop').classList.add('hidden')}},
            finishAnswer:()=>{App.toRatingPhase()},
            toRatingPhase:()=>{clearInterval(State.timer);window.speechSynthesis.cancel();document.getElementById('ctrl-answer').classList.add('hidden');document.getElementById('ctrl-rate').classList.remove('hidden')},
            saveResult:(s)=>{document.querySelectorAll('.btn-rate').forEach(b=>b.disabled=true);State.count++;State.results.push(s);State.history.unshift({q:State.currentQ.q,score:s,date:new Date().toLocaleDateString()});if(State.history.length>50)State.history.pop();Utils.storage.set('history',State.history);setTimeout(App.nextQuestion,400)},
            quit:()=>{clearInterval(State.timer);window.speechSynthesis.cancel();if(State.mediaRecorder&&State.mediaRecorder.state==='recording'){State.mediaRecorder.stop()}document.getElementById('view-practice').classList.add('hidden');App.renderHistory()},
            checkStreak:()=>{const t=new Date().toDateString(),l=Utils.storage.get('lastVisit','');let s=Utils.storage.get('streak',0);if(l){const d=(new Date(t)-new Date(l))/(1000*60*60*24);if(d>=1&&d<2)s++;else if(d>=2)s=1}else{s=1}Utils.storage.set('lastVisit',t);Utils.storage.set('streak',s);if(s>1){document.getElementById('streak-count').innerText=s;document.getElementById('streak-badge').classList.remove('hidden')}},
            showResult:()=>{window.speechSynthesis.cancel();document.getElementById('view-practice').classList.add('hidden');document.getElementById('modal-result').classList.remove('hidden');const n=State.results.length,a=n>0?(State.results.reduce((x,y)=>x+y,0)/n):0;document.getElementById('res-count').innerText=n;let m="Nice Try!";if(a>=4.5)m="Excellent! å®Œç’§ã§ã™âœ¨";else if(a>=3.5)m="Great! è‡ªä¿¡ã‚’æŒã£ã¦ğŸ‘";else if(n>0)m="Good! ãã®èª¿å­ğŸ”¥";document.getElementById('res-msg').innerText=m;Utils.createConfetti()},
            closeResult:()=>{document.getElementById('modal-result').classList.add('hidden');App.renderHistory()},
            toggleHint:()=>{document.getElementById('hint-box').classList.remove('hidden');document.getElementById('btn-hint').classList.add('hidden')},
            startTimer:()=>{State.sec=0;document.getElementById('timer-display').innerText="00:00";clearInterval(State.timer);State.timer=setInterval(()=>{State.sec++;const m=String(Math.floor(State.sec/60)).padStart(2,'0'),s=String(State.sec%60).padStart(2,'0');document.getElementById('timer-display').innerText=`${m}:${s}`},1000)},
            updateCounter:()=>{const t=State.limit===999?"âˆ":State.limit;document.getElementById('q-counter').innerText=`${State.count+1}/${t}å•`},
            renderList:()=>{const c=document.getElementById('questions-list-container');c.innerHTML="";if(State.userQuestions.length>0){const h=document.createElement('div');h.className="text-xs font-bold text-purple-500 mt-4 mb-2 ml-1";h.innerText="â˜… Myè³ªå•";c.appendChild(h);State.userQuestions.forEach((q,i)=>{const e=document.createElement('div');e.className="bg-white p-4 rounded-xl border border-purple-100 flex justify-between items-center shadow-sm mb-2";e.innerHTML=`<div><p class="font-bold text-sm text-slate-700">${q.q}</p><p class="text-xs text-slate-400 mt-1">ãƒ’ãƒ³ãƒˆ: ${q.hint||'-'}</p></div><button onclick="UserData.remove(${i})" class="text-red-400 text-xs font-bold border border-red-200 px-3 py-1.5 rounded-lg hover:bg-red-50">å‰Šé™¤</button>`;c.appendChild(e)})}['highschool','university','job'].forEach(cat=>{const h=document.createElement('div');h.className="text-xs font-bold text-slate-400 mt-6 mb-2 ml-1 uppercase";h.innerText=cat;c.appendChild(h);DB.questions[cat].forEach(q=>{const e=document.createElement('div');e.className="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-2";const rel=State.history.filter(h=>h.q===q.q);let b="";if(rel.length>0){const a=rel.reduce((x,y)=>x+y.score,0)/rel.length;if(a<2.5)b=`<span class="bg-red-100 text-red-500 text-[10px] px-2 py-0.5 rounded-md font-bold ml-2">âš ï¸ è‹¦æ‰‹</span>`;else if(a>=4.5)b=`<span class="bg-yellow-100 text-yellow-600 text-[10px] px-2 py-0.5 rounded-md font-bold ml-2">ğŸ‘‘ å¾—æ„</span>`}e.innerHTML=`<p class="font-bold text-sm text-slate-700 flex items-center">${q.q}${b}</p><p class="text-xs text-slate-400 mt-1">ğŸ’¡ ${q.hint}</p>`;c.appendChild(e)})})},
            renderHistory:()=>{const l=document.getElementById('history-list');l.innerHTML="";if(State.history.length===0){l.innerHTML='<div class="p-8 text-center text-xs text-slate-400">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';document.getElementById('stat-count').innerText="0";document.getElementById('stat-avg').innerText="-";return}const a=State.history.reduce((x,y)=>x+y.score,0)/State.history.length;document.getElementById('stat-count').innerText=State.history.length;document.getElementById('stat-avg').innerText=a.toFixed(1);State.history.forEach(h=>{const e=document.createElement('div');e.className="p-4 flex justify-between items-center hover:bg-slate-50 transition";let f=h.score===1?'ğŸ˜–':(h.score===3?'ğŸ˜':'ğŸ˜†'),c=h.score===1?'text-slate-400':(h.score===3?'text-slate-500':'text-yellow-500');e.innerHTML=`<div class="flex-1 min-w-0 pr-4"><p class="text-sm font-bold text-slate-700 truncate">${h.q}</p><p class="text-[10px] text-slate-400 mt-0.5">${h.date}</p></div><div class="text-2xl ${c}">${f}</div>`;l.appendChild(e)})}
        };
        const UserData={add:()=>{const q=document.getElementById('new-q-text').value.trim(),h=document.getElementById('new-q-hint').value.trim();if(!q)return;State.userQuestions.push({q:q,hint:h});Utils.storage.set('myQuestions',State.userQuestions);document.getElementById('new-q-text').value="";document.getElementById('new-q-hint').value="";App.renderList();Utils.toast("è³ªå•ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼")},remove:(i)=>{if(!confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))return;State.userQuestions.splice(i,1);Utils.storage.set('myQuestions',State.userQuestions);App.renderList();Utils.toast("å‰Šé™¤ã—ã¾ã—ãŸ")},clearHistory:()=>{if(!confirm("å±¥æ­´ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚"))return;State.history=[];Utils.storage.set('history',[]);App.renderHistory();App.renderList();Utils.toast("å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ")}};
        const Social={shareApp:()=>{const t=`é¢æ¥å¯¾ç­–ã‚¢ãƒ—ãƒªã€Œã‚ã‚“ã›ã¤â˜…ãƒãƒƒã‚¯ã€\nä½œæˆè€…: å½—çœ ãƒãƒ«ãƒğŸ’¤ ${CONFIG.ACCOUNTS.X}\n\nã‚¹ãƒãƒ›ã§é¢æ¥ç·´ç¿’ã—ã¦ã¿ãŸï¼`;window.open(`${CONFIG.URLS.X_SHARE}?text=${encodeURIComponent(t)}&url=${encodeURIComponent(location.href)}`,'_blank')},shareResult:()=>{const c=State.results.length;if(c===0)return;const a=State.results.reduce((x,y)=>x+y,0)/c;const t=`ã€ã‚ã‚“ã›ã¤â˜…ãƒãƒƒã‚¯ã€‘\né¢æ¥ç·´ç¿’ ${c}å•ã‚¯ãƒªã‚¢ï¼\nä»Šå›ã®ã‚¹ã‚³ã‚¢: ${a.toFixed(1)}/5.0\n\nä½œæˆè€…: å½—çœ ãƒãƒ«ãƒğŸ’¤ ${CONFIG.ACCOUNTS.X}`;window.open(`${CONFIG.URLS.X_SHARE}?text=${encodeURIComponent(t)}&url=${encodeURIComponent(location.href)}`,'_blank')}};
        window.onload=App.init;
    </script>
</body>
</html>
